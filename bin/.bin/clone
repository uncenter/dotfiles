#!/usr/bin/env zsh

usage() {
    cat <<EOF
clone - clone with gh or git in the right directory
usage: clone <repo|owner/repo|URL> [directory]
EOF
}

if [ -z "$1" ]; then
    usage
    exit 0
elif [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]]; then
    usage
    echo
    cat <<EOF
$ clone uncenter/dotfiles
$ clone https://github.com/uncenter/dotfiles
EOF
    exit 0
fi

CLONE_DIR="${XDG_DEV_DIR:-"$HOME"}"
if [[ "$PWD" != "$CLONE_DIR" ]]; then
    echo -n "Are you sure you want to clone in $PWD? (y/n/cd) "
    read -r answer
    if [[ $answer == "n" ]]; then
        exit 1
    fi
    if [[ $answer == "cd" ]]; then
        echo "Switching to $CLONE_DIR..."
        cd "$CLONE_DIR" || exit 1
    fi
fi
if [[ $1 == http://* || $1 == https://* ]]; then
    git clone "$@"
else
    if ! command -v gh &> /dev/null; then
        echo "clone: error: required command \`gh\` not installed"
        exit 1
    fi
    gh repo clone "$@"
fi
