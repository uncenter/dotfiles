#!/usr/bin/env bash

usage() {
    echo "usage: git-branch-rm <branch> [remote]"
}

current_branch() { git branch --show-current; }

if [ ! $# -eq 0 ]; then
    if [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]]; then
        usage
        exit 1
    fi
fi

branch=${1:-$(current_branch)}
remote=${2:-origin}
if [ $branch = "main" ] || [ $branch = "master" ]; then
    echo "Cannot delete branch '$branch' using git-branch-rm."
    exit 1
fi
answer=$(basename $PWD)@$branch
echo -n "You are attempting to delete branch '$branch'.
To confirm, enter the name of current directory and branch ($answer): "
read -r response
if [ $response != "$answer" ]; then
    echo "Given string does not match prompt."
    exit 1
fi
git checkout master &> /dev/null || git checkout main &> /dev/null || (echo "Could not switch to main/master branch automatically." && exit 1)
echo "Switched to branch '$(current_branch)'."

git branch -d "$branch" &> /dev/null && echo "Deleted local branch '$branch'." || echo "Tried '$branch'; does not exist locally." 
git push "$remote" --delete "$branch" &> /dev/null && echo "Deleted '$remote/$branch'." || echo "Tried '$remote/$branch'; does not exist remotely."

